[buildout]
extends =
  buildout.hash.cfg
  ../../component/redis/buildout.cfg
  ../../stack/lamp/buildout.cfg

[nc-download-base]
recipe = hexagonit.recipe.download
ignore-existing = true
download-only = true
url = ${:_profile_base_location_}/${:filename}
mode = 0644


[application]
url = https://download.nextcloud.com/server/releases/latest-19.tar.bz2
md5sum = f0da9b00260d0fa781b3fa3043f32cef

[template-nextcloud-install.sh] 
<= nc-download-base

[template-apache-httpd]
<= nc-download-base

[template-nextcloud-config.json]
<= nc-download-base

[template-nextcloud-instance]
recipe = slapos.recipe.template:jinja2
template = ${:_profile_base_location_}/${:filename}
rendered = ${buildout:directory}/instance-nextcloud.cfg
extensions = jinja2.ext.do
context = 
          key gzip_location          gzip:location
          key python3_location       python3:location
          key news_updater_location  news-updater:location
          key php_location           apache-php:location
          raw redis_bin              ${redis:location}/bin/redis-server
          raw redis_cli              ${redis:location}/bin/redis-cli
          raw nextcloud_install_sh   ${template-nextcloud-install.sh:location}/${template-nextcloud-install.sh:filename}
          raw nextcloud_apache_httpd ${template-apache-httpd:location}/${template-apache-httpd:filename}
          raw nextcloud_parameter_json ${template-nextcloud-config.json:location}/${template-nextcloud-config.json:filename}
          section nextcloud_apps     nextcloud-apps

[custom-application-deployment]
path = ${template-nextcloud-instance:rendered}
part-list = nextcloud-install.sh

[news-updater]
recipe = hexagonit.recipe.download
url = https://github.com/nextcloud/news-updater/archive/10.0.1.tar.gz
md5sum = 37387199c0482e08d01e9294cd95eaad
strip-top-level-dir = true

[nc-download-app]
<= nc-download-base
download-only = false
strip-top-level-dir = true

[nextcloud-app-spreed]
<= nc-download-app
url = https://github.com/nextcloud/spreed/releases/download/v9.0.9/spreed-9.0.9.tar.gz
md5sum = 4385e2add39106e0a201bfa7d26c87cb

[nextcloud-app-richdocuments]
<= nc-download-app
url = https://github.com/nextcloud-releases/richdocuments/releases/download/v3.8.3/richdocuments.tar.gz
md5sum = 01c26e9d54b273ca07da6d295c379799

[nextcloud-app-calendar]
<= nc-download-app
url = https://github.com/nextcloud/calendar/releases/download/v2.0.5/calendar.tar.gz
md5sum = dcbb4b74a4a1b913b42144e21f220f30

[nextcloud-app-rainloop]
<= nc-download-app
url = https://github.com/pierre-alain-b/rainloop-nextcloud/releases/download/7.1.0/rainloop.tar.gz
md5sum = 07629927e0b6a60baf08cea1387fc909

[nextcloud-app-news]
<= nc-download-app
url = https://github.com/nextcloud/news/releases/download/14.2.2/news.tar.gz
md5sum = f48d4b5dcbc078131bb86a4ae619da99

[nextcloud-apps]
spreed = ${nextcloud-app-spreed:location}
richdocuments = ${nextcloud-app-richdocuments:location}
calendar = ${nextcloud-app-calendar:location}
rainloop = ${nextcloud-app-rainloop:location}
news = ${nextcloud-app-news:location}
